function init(){var e=new google.maps.LatLng(40.867,-73.38),t=new google.maps.InfoWindow,o=-99999,a=99999;navigator.geolocation.getCurrentPosition(function(e){o=e.coords.latitude,a=e.coords.longitude,function(e,o){var a=new google.maps.LatLng(parseFloat(e),parseFloat(o));request=new XMLHttpRequest,request.open("POST","https://bagged-inukshuk-96259.herokuapp.com/rides",!0),request.setRequestHeader("Content-type","application/x-www-form-urlencoded");var n="username=PT88yXTq&lat="+e.toString()+"&lng="+o.toString();e=parseFloat(e),o=parseFloat(o),request.onreadystatechange=function(){if(4==request.readyState&&200==request.status){var n=JSON.parse(request.responseText),r=99999999999,l=[];for(let e=0;e<n.length;e++){let t=new XMLHttpRequest;var g="https://api.onwater.io/api/v1/results/"+parseFloat(n[e].lat).toString()+","+parseFloat(n[e].lng).toString()+"?access_token=DiidmAH8hDQbvYzXFXrU";t.open("GET",g),t.responseType="json",t.send(),t.onload=function(){let o=t.response;if(console.log(o.water),!o.water){var r=new google.maps.LatLng(parseFloat(n[e].lat),parseFloat(n[e].lng)),g=new google.maps.Marker({position:r,title:"close uber",icon:"car.png"});if(g.setMap(s),l[e]=g,google.maps.geometry.spherical.computeDistanceBetween(a,r)<p){var p=google.maps.geometry.spherical.computeDistanceBetween(a,r);console.log("Closest : "),console.log(p)}}}}new google.maps.LatLng(parseFloat(n[0].lat),parseFloat(n[0].lng)),r*=62137e-8;var p="Closest vehicle: "+n[0].username.toString()+", at a distance of "+r.toString()+" miles",i=new google.maps.Marker({position:a,title:p});i.setMap(s),google.maps.event.addListener(i,"click",function(){t.setContent(i.title),t.open(s,i)});var c=[new google.maps.LatLng(e,o),new google.maps.LatLng(n[0].lat,n[0].lng)];const u=new google.maps.Polyline({path:c,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2});u.setMap(s)}},request.send(n)}(parseFloat(o),parseFloat(a))});var n={zoom:10,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP},s=new google.maps.Map(document.getElementById("map_canvas"),n)}
